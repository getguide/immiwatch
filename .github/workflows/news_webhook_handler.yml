name: News Webhook Handler

on:
  repository_dispatch:
    types: [news_article]

jobs:
  process_news_webhook:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      
    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.11'
        
    - name: Install dependencies
      run: |
        pip install requests pathlib2
        
    - name: Process news webhook
      id: news_webhook
      run: |
        python3 scripts/news_automation.py
        
    - name: Notify Slack - Success
      if: steps.news_webhook.outputs.success == 'true'
      run: |
        curl -X POST -H 'Content-type: application/json' \
        --data '{
          "text": "ğŸ‰ *News Article Published Successfully!*\n\nğŸ“° *Article Details:*\nâ€¢ **Headline:** ${{ github.event.client_payload.headline }}\nâ€¢ **Category:** ${{ github.event.client_payload.category }}\nâ€¢ **Impact:** ${{ github.event.client_payload.impact }}\nâ€¢ **Date:** ${{ github.event.client_payload.date_of_update }}\nâ€¢ **Source:** ${{ github.event.client_payload.source }}\n\nğŸ“ˆ **Article URL:** ${{ steps.news_webhook.outputs.article_url }}\nğŸ”— **View Article:** https://immiwatch.ca/news/daily/${{ github.event.client_payload.category }}/${{ github.event.client_payload.date_of_update }}/${{ steps.news_webhook.outputs.slug }}/\n\nâœ… **Status:** Article published and pages updated\n\nğŸ“Š **Summary:** Added new ${{ github.event.client_payload.category }} article to website\n\nğŸ”— **GitHub Commit:** https://github.com/${{ github.repository }}/commit/${{ github.sha }}"
        }' \
        ${{ secrets.SLACK_WEBHOOK_URL }}
    
    - name: Notify Slack - Failure
      if: steps.news_webhook.outputs.success == 'false'
      run: |
        curl -X POST -H 'Content-type: application/json' \
        --data '{
          "text": "âŒ *News Article Processing Failed!*\n\nğŸ“° *Article Details:*\nâ€¢ **Headline:** ${{ github.event.client_payload.headline }}\nâ€¢ **Category:** ${{ github.event.client_payload.category }}\nâ€¢ **Impact:** ${{ github.event.client_payload.impact }}\nâ€¢ **Date:** ${{ github.event.client_payload.date_of_update }}\nâ€¢ **Source:** ${{ github.event.client_payload.source }}\n\nğŸš¨ **Error Details:**\n${{ steps.news_webhook.outputs.error }}\n\nğŸ” **Debug Info:**\nâ€¢ **GitHub Run:** ${{ github.run_id }}\nâ€¢ **Workflow:** ${{ github.workflow }}\nâ€¢ **Repository:** ${{ github.repository }}\nâ€¢ **Branch:** ${{ github.ref }}\n\nâš ï¸ **Action Required:** Manual intervention needed\n\nğŸ”— **View Logs:** https://github.com/${{ github.repository }}/actions/runs/${{ github.run_id }}"
        }' \
        ${{ secrets.SLACK_WEBHOOK_URL }} 